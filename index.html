<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Request Processor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-section, .output-section {
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .clear-btn {
            background-color: #f44336;
        }
        .clear-btn:hover {
            background-color: #da190b;
        }
        .copy-btn {
            background-color: #2196F3;
        }
        .copy-btn:hover {
            background-color: #1976D2;
        }
        .stats {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        /* Excel-like table styling */
        .table-container {
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .table-title {
            background-color: #2c3e50;
            color: white;
            padding: 12px 16px;
            font-weight: bold;
            font-size: 14px;
            margin: 0;
        }
        .table-wrapper {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
        }
        .excel-table th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 600;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .excel-table td {
            padding: 10px 16px;
            border-bottom: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            background-color: white;
        }
        .excel-table tr:nth-child(even) td {
            background-color: #f8f9fa;
        }
        .excel-table tr:hover td {
            background-color: #e3f2fd;
        }
        .excel-table .dept-id {
            font-weight: 600;
            color: #2c3e50;
        }
        .excel-table .check-mark {
            text-align: center;
            font-weight: bold;
            color: #dc3545;
            font-size: 16px;
        }
        .excel-table .approved-mark {
            color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Access Request Processor</h1>
        
        <div class="input-section">
            <label for="inputText">Paste your access request text here:</label>
            <textarea id="inputText" placeholder="Paste your access request text here..."></textarea>
        </div>
        
        <div class="button-group">
            <button onclick="processText()">üìã Process Text</button>
            <button onclick="clearAll()" class="clear-btn">üóëÔ∏è Clear All</button>
        </div>
        
        <div id="results"></div>
        
        <div class="output-section" id="outputSection" style="display: none;">
            <div id="tablesOutput"></div>
            <div class="button-group">
                <button onclick="copyToClipboard()" class="copy-btn">üìÑ Copy Results</button>
            </div>
        </div>
    </div>

    <script>
        function processText() {
            const input = document.getElementById('inputText').value;
            const resultsDiv = document.getElementById('results');
            const outputSection = document.getElementById('outputSection');
            const outputText = document.getElementById('outputText');
            
            if (!input.trim()) {
                resultsDiv.innerHTML = '<div class="error">Please paste some text to process.</div>';
                outputSection.style.display = 'none';
                return;
            }
            
            try {
                const result = extractAccessInfo(input);
                
                if (result.error) {
                    resultsDiv.innerHTML = `<div class="error">${result.error}</div>`;
                    outputSection.style.display = 'none';
                    return;
                }
                
                // Show stats
                resultsDiv.innerHTML = `
                    <div class="stats">
                        <strong>Processing Complete!</strong><br>
                        Affected User: ${result.affectedUser}<br>
                        Total Entries: ${result.entries.length}<br>
                        Removed/Approved: ${result.entries.length}
                    </div>
                `;
                
                // Group entries by department number and status
                const removedByDept = {};
                const approvedByDept = {};
                
                result.entries.forEach(entry => {
                    const deptNum = entry.departmentNumber;
                    const role = entry.role;
                    
                    if (entry.status === 'Removed') {
                        if (!removedByDept[deptNum]) {
                            removedByDept[deptNum] = { eForms: false, payroll: false, applicant: false };
                        }
                        if (role.includes('eForms')) removedByDept[deptNum].eForms = true;
                        if (role.includes('Payroll')) removedByDept[deptNum].payroll = true;
                        if (role.includes('Applicant')) removedByDept[deptNum].applicant = true;
                    } else if (entry.status === 'Approved') {
                        if (!approvedByDept[deptNum]) {
                            approvedByDept[deptNum] = { eForms: false, payroll: false, applicant: false };
                        }
                        if (role.includes('eForms')) approvedByDept[deptNum].eForms = true;
                        if (role.includes('Payroll')) approvedByDept[deptNum].payroll = true;
                        if (role.includes('Applicant')) approvedByDept[deptNum].applicant = true;
                    }
                });
                
                // Generate HTML output
                let htmlOutput = `<div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                    <strong>Affected User:</strong> ${result.affectedUser}
                </div>`;
                
                // Removed table
                const removedDepts = Object.keys(removedByDept).sort((a, b) => parseInt(a) - parseInt(b));
                if (removedDepts.length > 0) {
                    htmlOutput += `
                    <div class="table-container">
                        <div class="table-title">üóëÔ∏è REMOVED ROLES</div>
                        <div class="table-wrapper">
                            <table class="excel-table">
                                <thead>
                                    <tr>
                                        <th>Department ID</th>
                                        <th>eForms Access</th>
                                        <th>Payroll Reporter</th>
                                        <th>Applicant Tracking</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    removedDepts.forEach(deptNum => {
                        const roles = removedByDept[deptNum];
                        htmlOutput += `
                                    <tr>
                                        <td class="dept-id">${deptNum}</td>
                                        <td class="check-mark">${roles.eForms ? '‚úì' : ''}</td>
                                        <td class="check-mark">${roles.payroll ? '‚úì' : ''}</td>
                                        <td class="check-mark">${roles.applicant ? '‚úì' : ''}</td>
                                    </tr>`;
                    });
                    
                    htmlOutput += `
                                </tbody>
                            </table>
                        </div>
                    </div>`;
                }
                
                // Approved table
                const approvedDepts = Object.keys(approvedByDept).sort((a, b) => parseInt(a) - parseInt(b));
                if (approvedDepts.length > 0) {
                    htmlOutput += `
                    <div class="table-container">
                        <div class="table-title">‚úÖ APPROVED ROLES</div>
                        <div class="table-wrapper">
                            <table class="excel-table">
                                <thead>
                                    <tr>
                                        <th>Department ID</th>
                                        <th>eForms Access</th>
                                        <th>Payroll Reporter</th>
                                        <th>Applicant Tracking</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                    
                    approvedDepts.forEach(deptNum => {
                        const roles = approvedByDept[deptNum];
                        htmlOutput += `
                                    <tr>
                                        <td class="dept-id">${deptNum}</td>
                                        <td class="check-mark approved-mark">${roles.eForms ? '‚úì' : ''}</td>
                                        <td class="check-mark approved-mark">${roles.payroll ? '‚úì' : ''}</td>
                                        <td class="check-mark approved-mark">${roles.applicant ? '‚úì' : ''}</td>
                                    </tr>`;
                    });
                    
                    htmlOutput += `
                                </tbody>
                            </table>
                        </div>
                    </div>`;
                }
                
                document.getElementById('tablesOutput').innerHTML = htmlOutput;
                outputSection.style.display = 'block';
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error processing text: ${error.message}</div>`;
                outputSection.style.display = 'none';
            }
        }
        
        function extractAccessInfo(text) {
            const result = {
                affectedUser: '',
                entries: [],
                error: null
            };
            
            // Extract affected user
            const affectedUserMatch = text.match(/\*Affected User\*\s*\n\[mailto:([^\]]+)\]/);
            if (!affectedUserMatch) {
                // Try alternative patterns
                const altMatch1 = text.match(/\*Affected User\*[\s\S]*?\[mailto:([^\]]+)\]/);
                const altMatch2 = text.match(/Affected User[\s\S]*?\[mailto:([^\]]+)\]/);
                if (altMatch1) {
                    result.affectedUser = altMatch1[1];
                } else if (altMatch2) {
                    result.affectedUser = altMatch2[1];
                } else {
                    return { error: 'Could not find Affected User information' };
                }
            } else {
                result.affectedUser = affectedUserMatch[1];
            }
            
            // Extract table entries
            const lines = text.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                
                // Look for table rows with || (not |||)
                if (line.includes('||') && line.includes('(') && line.includes(')') && !line.includes('Role')) {
                    // Extract role (first column after ||)
                    const roleMatch = line.match(/\|\|\s*([^|]+?)\s*\|/);
                    if (!roleMatch) continue;
                    
                    // Extract department number from parentheses
                    const deptMatch = line.match(/\((\d+)\)/);
                    if (!deptMatch) continue;
                    
                    // Extract status - look for "Removed" or "Approved" 
                    let status = null;
                    if (line.includes('Removed')) {
                        status = 'Removed';
                    } else if (line.includes('Approved')) {
                        status = 'Approved';
                    }
                    
                    // Only include if we found a relevant status
                    if (status) {
                        result.entries.push({
                            role: roleMatch[1].trim(),
                            departmentNumber: deptMatch[1].trim(),
                            status: status
                        });
                    }
                }
            }
            
            if (result.entries.length === 0) {
                return { error: `No entries found with "Removed" or "Approved" status.` };
            }
            
            return result;
        }
        
        function clearAll() {
            document.getElementById('inputText').value = '';
            document.getElementById('tablesOutput').innerHTML = '';
            document.getElementById('results').innerHTML = '';
            document.getElementById('outputSection').style.display = 'none';
        }
        
        async function copyToClipboard() {
            // Extract text from the HTML tables
            let textOutput = '';
            
            // Get affected user
            const userDiv = document.querySelector('#tablesOutput div');
            if (userDiv) {
                textOutput += userDiv.textContent + '\n\n';
            }
            
            // Get tables
            const tables = document.querySelectorAll('.excel-table');
            const titles = document.querySelectorAll('.table-title');
            
            for (let i = 0; i < tables.length; i++) {
                if (titles[i]) {
                    textOutput += titles[i].textContent + '\n';
                    textOutput += '='.repeat(50) + '\n';
                }
                
                const table = tables[i];
                const headers = table.querySelectorAll('th');
                const rows = table.querySelectorAll('tbody tr');
                
                // Add headers
                headers.forEach((header, index) => {
                    textOutput += header.textContent.padEnd(18);
                    if (index < headers.length - 1) textOutput += '| ';
                });
                textOutput += '\n';
                textOutput += '-'.repeat(80) + '\n';
                
                // Add rows
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    cells.forEach((cell, index) => {
                        let cellText = cell.textContent.trim();
                        if (cellText === '‚úì') cellText = 'X';
                        textOutput += cellText.padEnd(18);
                        if (index < cells.length - 1) textOutput += '| ';
                    });
                    textOutput += '\n';
                });
                textOutput += '\n';
            }
            
            try {
                await navigator.clipboard.writeText(textOutput);
                
                // Temporary feedback
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '‚úÖ Copied!';
                button.disabled = true;
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 2000);
                
            } catch (err) {
                // Fallback - create temporary textarea
                const textarea = document.createElement('textarea');
                textarea.value = textOutput;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Results copied to clipboard!');
            }
        }
        
        // Auto-process when pasting
        document.getElementById('inputText').addEventListener('paste', function() {
            setTimeout(() => {
                processText();
            }, 100);
        });
    </script>
</body>
</html>
