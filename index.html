<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Request Processor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* Tabs Styling */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab-btn {
            background: none;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab-btn:hover {
            color: #4CAF50;
            background-color: #f9f9f9;
        }
        .tab-btn.active {
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Input/Output Styling */
        .input-section, .output-section {
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            height: 250px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            box-sizing: border-box;
        }
        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        .clear-btn { background-color: #f44336; }
        .clear-btn:hover { background-color: #da190b; }
        .copy-btn { background-color: #2196F3; }
        .copy-btn:hover { background-color: #1976D2; }
        
        /* Helper Classes */
        .stats {
            background-color: #e8f5e8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        /* Org Change Output Specifics - UPDATED FONT */
        .email-output {
            background-color: #ffffff; /* White background like email */
            border: 1px solid #ddd;
            padding: 20px;
            white-space: pre-wrap;
            font-family: Arial, Helvetica, sans-serif; /* ARIAL FONT */
            font-size: 12pt; /* 12PT SIZE */
            color: #000000;
            max-height: 500px;
            overflow-y: auto;
            line-height: 1.5;
        }

        /* Access Request Table Styling */
        .table-container {
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .table-title {
            background-color: #2c3e50;
            color: white;
            padding: 12px 16px;
            font-weight: bold;
            font-size: 14px;
            margin: 0;
        }
        .table-wrapper {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 13px;
        }
        .excel-table th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 600;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 2px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .excel-table td {
            padding: 10px 16px;
            border-bottom: 1px solid #dee2e6;
            border-right: 1px solid #dee2e6;
            background-color: white;
        }
        .excel-table tr:nth-child(even) td { background-color: #f8f9fa; }
        .excel-table .dept-id { font-weight: 600; color: #2c3e50; }
        .excel-table .check-mark { text-align: center; font-weight: bold; color: #dc3545; font-size: 16px; }
        .excel-table .approved-mark { color: #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <h1>HRIT Utilities</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('accessTab')">üîß Access Request</button>
            <button class="tab-btn" onclick="openTab('orgTab')">üè¢ Org Changes</button>
        </div>

        <div id="accessTab" class="tab-content active">
            <div class="input-section">
                <label for="inputText">Paste Access Request text here:</label>
                <textarea id="inputText" placeholder="Paste your access request text here..."></textarea>
            </div>
            
            <div class="button-group">
                <button onclick="processAccessText()">üìã Process Access Request</button>
                <button onclick="clearAccess()" class="clear-btn">üóëÔ∏è Clear</button>
            </div>
            
            <div id="accessResults"></div>
            
            <div class="output-section" id="accessOutputSection" style="display: none;">
                <div id="tablesOutput"></div>
                <div class="button-group">
                    <button onclick="copyAccessResults()" class="copy-btn">üìÑ Copy Tables</button>
                </div>
            </div>
        </div>

        <div id="orgTab" class="tab-content">
            <div class="input-section">
                <label for="orgInputText">Paste Org Change text here:</label>
                <textarea id="orgInputText" placeholder="Paste Org Change list (separated by dashes)..."></textarea>
            </div>
            
            <div class="button-group">
                <button onclick="processOrgChanges()">üîÑ Format for Email</button>
                <button onclick="clearOrg()" class="clear-btn">üóëÔ∏è Clear</button>
            </div>

            <div id="orgResults"></div>

            <div class="output-section" id="orgOutputSection" style="display: none;">
                <label>Formatted for Email (Arial 12pt):</label>
                <div id="orgEmailOutput" class="email-output"></div>
                <div class="button-group">
                    <button onclick="copyOrgResults()" class="copy-btn">üìÑ Copy Email Text</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // TAB LOGIC
        // ==========================================
        function openTab(tabName) {
            const contents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            const buttons = document.getElementsByClassName('tab-btn');
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // ==========================================
        // ACCESS REQUEST LOGIC
        // ==========================================
        function processAccessText() {
            const input = document.getElementById('inputText').value;
            const resultsDiv = document.getElementById('accessResults');
            const outputSection = document.getElementById('accessOutputSection');
            
            if (!input.trim()) {
                resultsDiv.innerHTML = '<div class="error">Please paste some text to process.</div>';
                outputSection.style.display = 'none';
                return;
            }
            
            try {
                const result = extractAccessInfo(input);
                if (result.error) {
                    resultsDiv.innerHTML = `<div class="error">${result.error}</div>`;
                    outputSection.style.display = 'none';
                    return;
                }
                
                resultsDiv.innerHTML = `
                    <div class="stats">
                        <strong>Processing Complete!</strong><br>
                        Affected User: ${result.affectedUser}<br>
                        Entries Found: ${result.entries.length}
                    </div>
                `;
                
                const removedByDept = {};
                const approvedByDept = {};
                
                result.entries.forEach(entry => {
                    const deptNum = entry.departmentNumber;
                    const role = entry.role;
                    if (entry.status === 'Removed') {
                        if (!removedByDept[deptNum]) removedByDept[deptNum] = { eForms: false, payroll: false, applicant: false };
                        if (role.includes('eForms')) removedByDept[deptNum].eForms = true;
                        if (role.includes('Payroll')) removedByDept[deptNum].payroll = true;
                        if (role.includes('Applicant')) removedByDept[deptNum].applicant = true;
                    } else if (entry.status === 'Approved') {
                        if (!approvedByDept[deptNum]) approvedByDept[deptNum] = { eForms: false, payroll: false, applicant: false };
                        if (role.includes('eForms')) approvedByDept[deptNum].eForms = true;
                        if (role.includes('Payroll')) approvedByDept[deptNum].payroll = true;
                        if (role.includes('Applicant')) approvedByDept[deptNum].applicant = true;
                    }
                });
                
                let htmlOutput = `<div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;"><strong>Affected User:</strong> ${result.affectedUser}</div>`;
                
                const removedDepts = Object.keys(removedByDept).sort((a, b) => parseInt(a) - parseInt(b));
                if (removedDepts.length > 0) {
                    htmlOutput += generateTable('üóëÔ∏è REMOVED ROLES', removedDepts, removedByDept, false);
                }
                const approvedDepts = Object.keys(approvedByDept).sort((a, b) => parseInt(a) - parseInt(b));
                if (approvedDepts.length > 0) {
                    htmlOutput += generateTable('‚úÖ APPROVED ROLES', approvedDepts, approvedByDept, true);
                }
                
                document.getElementById('tablesOutput').innerHTML = htmlOutput;
                outputSection.style.display = 'block';
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                outputSection.style.display = 'none';
            }
        }

        function generateTable(title, depts, dataMap, isApproved) {
            let html = `
            <div class="table-container">
                <div class="table-title">${title}</div>
                <div class="table-wrapper">
                    <table class="excel-table">
                        <thead><tr><th>Department ID</th><th>eForms Access</th><th>Payroll Reporter</th><th>Applicant Tracking</th></tr></thead>
                        <tbody>`;
            depts.forEach(dept => {
                const roles = dataMap[dept];
                const markClass = isApproved ? 'check-mark approved-mark' : 'check-mark';
                html += `<tr>
                    <td class="dept-id">${dept}</td>
                    <td class="${markClass}">${roles.eForms ? '‚úì' : ''}</td>
                    <td class="${markClass}">${roles.payroll ? '‚úì' : ''}</td>
                    <td class="${markClass}">${roles.applicant ? '‚úì' : ''}</td>
                </tr>`;
            });
            html += `</tbody></table></div></div>`;
            return html;
        }

        function extractAccessInfo(text) {
            const result = { affectedUser: '', entries: [], error: null };
            const affectedUserMatch = text.match(/\*Affected User\*\s*\n\[mailto:([^\]]+)\]/) || 
                                      text.match(/Affected User[\s\S]*?\[mailto:([^\]]+)\]/);
            
            if (!affectedUserMatch) return { error: 'Could not find Affected User information' };
            result.affectedUser = affectedUserMatch[1];
            
            const lines = text.split('\n');
            lines.forEach(line => {
                if (line.includes('||') && line.includes('(') && line.includes(')') && !line.includes('Role')) {
                    const roleMatch = line.match(/\|\|\s*([^|]+?)\s*\|/);
                    const deptMatch = line.match(/\((\d+)\)/);
                    if (roleMatch && deptMatch) {
                        let status = line.includes('Removed') ? 'Removed' : (line.includes('Approved') ? 'Approved' : null);
                        if (status) {
                            result.entries.push({ role: roleMatch[1].trim(), departmentNumber: deptMatch[1].trim(), status: status });
                        }
                    }
                }
            });
            if (result.entries.length === 0) return { error: 'No entries found.' };
            return result;
        }

        function clearAccess() {
            document.getElementById('inputText').value = '';
            document.getElementById('accessResults').innerHTML = '';
            document.getElementById('accessOutputSection').style.display = 'none';
        }

        async function copyAccessResults() {
            let textOutput = '';
            const userDiv = document.querySelector('#tablesOutput div');
            if(userDiv) textOutput += userDiv.textContent + '\n\n';
            
            const tables = document.querySelectorAll('.excel-table');
            const titles = document.querySelectorAll('.table-title');
            
            tables.forEach((table, i) => {
                if(titles[i]) textOutput += titles[i].textContent + '\n' + '='.repeat(50) + '\n';
                const rows = table.querySelectorAll('tr');
                rows.forEach(row => {
                    const cells = row.querySelectorAll('th, td');
                    cells.forEach((cell, idx) => {
                        let txt = cell.textContent.trim().replace('‚úì', 'X');
                        textOutput += txt.padEnd(20) + (idx < cells.length-1 ? '| ' : '');
                    });
                    textOutput += '\n';
                });
                textOutput += '\n';
            });
            copyToClipboard(textOutput, event.target);
        }

        // ==========================================
        // ORG CHANGE LOGIC
        // ==========================================
        function processOrgChanges() {
            const input = document.getElementById('orgInputText').value;
            const outputDiv = document.getElementById('orgEmailOutput');
            const resultDiv = document.getElementById('orgResults');
            const outputSection = document.getElementById('orgOutputSection');

            if (!input.trim()) {
                resultDiv.innerHTML = '<div class="error">Please paste text to process.</div>';
                outputSection.style.display = 'none';
                return;
            }

            const blocks = input.split(/-{5,}/);
            let formattedOutput = "";
            let count = 0;

            blocks.forEach(block => {
                if (!block.trim()) return;

                const deptMatch = block.match(/Org Change:\s*(\d+)/i);
                if (!deptMatch) return;

                const deptId = deptMatch[1].trim();
                
                const newMgrMatch = block.match(/New Manager:\s*(.*)/i);
                const oldMgrMatch = block.match(/Old Manager:\s*(.*)/i);
                const newNameMatch = block.match(/New Name:\s*(.*)/i);
                const newPhoneMatch = block.match(/New Phone:\s*(.*)/i);
                const newLocMatch = block.match(/New Location:\s*(.*)/i);
                const reportsToMatch = block.match(/New Reports To Org:\s*(\d+)/i);

                let entry = `Department ID: ${deptId}\n`;

                if (newMgrMatch) entry += `New Manager / uNID: ${newMgrMatch[1].trim()}\n`;
                if (oldMgrMatch) entry += `Old Manager / uNID: ${oldMgrMatch[1].trim()}\n`;
                if (newNameMatch) entry += `New Name: ${newNameMatch[1].trim()}\n`;
                
                if (newPhoneMatch) {
                    let phone = newPhoneMatch[1].trim().replace(/\//g, '-');
                    entry += `New Phone: ${phone}\n`;
                }

                if (newLocMatch) entry += `New Location: ${newLocMatch[1].trim()}\n`;
                if (reportsToMatch) entry += `Now Reports To: ${reportsToMatch[1].trim()}\n`;

                formattedOutput += entry + "\n";
                count++;
            });

            if (count === 0) {
                resultDiv.innerHTML = '<div class="error">No valid Org Changes found. Check format.</div>';
                outputSection.style.display = 'none';
            } else {
                resultDiv.innerHTML = `<div class="stats">Processed ${count} Org Changes</div>`;
                outputDiv.textContent = formattedOutput;
                outputSection.style.display = 'block';
            }
        }

        function clearOrg() {
            document.getElementById('orgInputText').value = '';
            document.getElementById('orgResults').innerHTML = '';
            document.getElementById('orgOutputSection').style.display = 'none';
        }

        function copyOrgResults() {
            const text = document.getElementById('orgEmailOutput').textContent;
            copyToClipboard(text, event.target);
        }

        async function copyToClipboard(text, btnElement) {
            try {
                await navigator.clipboard.writeText(text);
                const originalText = btnElement.textContent;
                btnElement.textContent = '‚úÖ Copied!';
                btnElement.disabled = true;
                setTimeout(() => {
                    btnElement.textContent = originalText;
                    btnElement.disabled = false;
                }, 2000);
            } catch (err) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Copied to clipboard');
            }
        }
    </script>
</body>
</html>
